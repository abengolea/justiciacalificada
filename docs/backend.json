{
  "entities": {
    "Lawyer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lawyer",
      "type": "object",
      "description": "Represents a lawyer registered in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the lawyer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the lawyer.",
          "format": "email"
        },
        "licenseNumber": {
          "type": "string",
          "description": "Professional license number of the lawyer."
        },
        "province": {
          "type": "string",
          "description": "Province where the lawyer is registered."
        },
        "isVerified": {
          "type": "boolean",
          "description": "Indicates if the lawyer's license has been verified."
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time when the lawyer registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "licenseNumber",
        "province",
        "isVerified",
        "registrationDate"
      ]
    },
    "Courthouse": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Courthouse",
      "type": "object",
      "description": "Represents a courthouse in Argentina.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the courthouse."
        },
        "name": {
          "type": "string",
          "description": "Name of the courthouse."
        },
        "province": {
          "type": "string",
          "description": "Province where the courthouse is located."
        },
        "city": {
          "type": "string",
          "description": "City where the courthouse is located."
        },
        "legalArea": {
          "type": "string",
          "description": "Legal area of the courthouse (e.g., Civil, Penal, Laboral)."
        },
        "level": {
          "type": "string",
          "description": "Level of the courthouse (e.g., First Instance, CÃ¡mara)."
        },
        "address": {
          "type": "string",
          "description": "Address of the courthouse."
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the courthouse."
        }
      },
      "required": [
        "id",
        "name",
        "province",
        "city",
        "legalArea",
        "level",
        "address",
        "phone"
      ]
    },
    "Rating": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Rating",
      "type": "object",
      "description": "Represents a rating given to a courthouse by a lawyer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the rating."
        },
        "courthouseId": {
          "type": "string",
          "description": "Reference to Courthouse. (Relationship: Courthouse 1:N Rating)"
        },
        "lawyerId": {
          "type": "string",
          "description": "Reference to Lawyer. (Relationship: Lawyer 1:N Rating)"
        },
        "efficiency": {
          "type": "number",
          "description": "Rating for procedural efficiency."
        },
        "resolutionTime": {
          "type": "number",
          "description": "Rating for resolution time."
        },
        "professionalAttention": {
          "type": "number",
          "description": "Rating for attention to professionals."
        },
        "administrativeOrganization": {
          "type": "number",
          "description": "Rating for administrative organization."
        },
        "accessibility": {
          "type": "number",
          "description": "Rating for accessibility."
        },
        "comment": {
          "type": "string",
          "description": "Anonymous comment about the courthouse."
        },
        "experienceDate": {
          "type": "string",
          "description": "Date of the lawyer's experience at the courthouse.",
          "format": "date-time"
        },
        "ratingDate": {
          "type": "string",
          "description": "Date and time when the rating was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "courthouseId",
        "lawyerId",
        "efficiency",
        "resolutionTime",
        "professionalAttention",
        "administrativeOrganization",
        "accessibility",
        "comment",
        "experienceDate",
        "ratingDate"
      ]
    },
    "Statistic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Statistic",
      "type": "object",
      "description": "Represents statistics for a courthouse.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the statistic."
        },
        "courthouseId": {
          "type": "string",
          "description": "Reference to Courthouse. (Relationship: Courthouse 1:1 Statistic)"
        },
        "generalAverage": {
          "type": "number",
          "description": "General average rating for the courthouse."
        },
        "totalRatings": {
          "type": "number",
          "description": "Total number of ratings for the courthouse."
        },
        "averageByCategory": {
          "type": "string",
          "description": "Average ratings by category (e.g., efficiency, resolution time). Represented as a JSON string.",
          "format": "json"
        },
        "lastUpdated": {
          "type": "string",
          "description": "Date and time when the statistics were last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "courthouseId",
        "generalAverage",
        "totalRatings",
        "averageByCategory",
        "lastUpdated"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/lawyers/{lawyerId}",
        "definition": {
          "entityName": "Lawyer",
          "schema": {
            "$ref": "#/backend/entities/Lawyer"
          },
          "description": "Stores lawyer profiles, using path-based ownership for security. Only the authenticated lawyer can read/write their own document.",
          "params": [
            {
              "name": "lawyerId",
              "description": "The unique identifier for the lawyer, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/courthouses/{courthouseId}",
        "definition": {
          "entityName": "Courthouse",
          "schema": {
            "$ref": "#/backend/entities/Courthouse"
          },
          "description": "Stores courthouse information. Publicly readable, but only admins can create/update/delete.",
          "params": [
            {
              "name": "courthouseId",
              "description": "The unique identifier for the courthouse."
            }
          ]
        }
      },
      {
        "path": "/courthouses/{courthouseId}/ratings/{ratingId}",
        "definition": {
          "entityName": "Rating",
          "schema": {
            "$ref": "#/backend/entities/Rating"
          },
          "description": "Stores ratings for each courthouse. Includes denormalized 'lawyerId' for authorization independence. Lawyers can only manage their own ratings. Includes the courthouseId to allow retrieving ratings for one courthouse.",
          "params": [
            {
              "name": "courthouseId",
              "description": "The unique identifier for the courthouse."
            },
            {
              "name": "ratingId",
              "description": "The unique identifier for the rating."
            }
          ]
        }
      },
      {
        "path": "/courthouses/{courthouseId}/statistics/{statisticId}",
        "definition": {
          "entityName": "Statistic",
          "schema": {
            "$ref": "#/backend/entities/Statistic"
          },
          "description": "Stores statistics for each courthouse. Only updated by trusted server-side code.",
          "params": [
            {
              "name": "courthouseId",
              "description": "The unique identifier for the courthouse."
            },
            {
              "name": "statisticId",
              "description": "The unique identifier for the statistic. Should only ever be one document."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "role",
          "schema": {
            "$ref": "#/backend/entities/Lawyer"
          },
          "description": "Documents in this collection grant admin privileges to the user with the matching UID. Existence over content.",
          "params": [
            {
              "name": "uid",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the core features of the \"Justicia Calificada\" application, emphasizing secure authentication, courthouse ratings, and statistical analysis. The structure prioritizes authorization independence, clear security rules, and efficient data retrieval. Path-based ownership is used for lawyers, and a combination of path-based ownership and denormalization is employed to manage access to ratings and statistics.\n\n**Authorization Independence:** Lawyer profiles are stored directly under `/lawyers/{lawyerId}` which allows easy management of lawyer-specific data and authentication. The `Rating` documents under `/courthouses/{courthouseId}/ratings/{ratingId}` include the `lawyerId`, enabling security rules to verify that the authenticated user (`request.auth.uid`) matches the rating's `lawyerId`. This avoids the need for `get()` calls to the `/lawyers/{lawyerId}` collection to check ownership.\n\n**QAPs Support:** The structure supports Query Approval Patterns (QAPs) by segregating data based on access requirements. Lawyers' data are stored in `/lawyers/{lawyerId}`, which allows listing lawyers with appropriate filtering rules. Courthouse data in `/courthouses/{courthouseId}` allows public listing while statistics are managed separately in `/courthouses/{courthouseId}/statistics/{statisticId}`, enabling different security rules for each. Ratings are located in a subcollection, ensuring we can query ratings for a specific courthouse, and because each rating contains the lawyerId, we can filter/secure lists of ratings based on the authenticated lawyer.\n\n**Denormalization:** The `Rating` documents include the `lawyerId`. This is a form of denormalization to enable security rules to ensure that only the lawyer who created the rating can modify or delete it. This eliminates the need for server-side validation to verify the user's identity against the rating data.\n\n**Global Roles (DBAC):** Global admin roles are stored in `/roles_admin/{uid}`. The existence of a document in this collection grants administrative privileges.\n"
  }
}