{
  "entities": {
    "Lawyer": {
      "title": "Lawyer",
      "description": "Represents a lawyer registered in the system.",
      "type": "object",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user's unique ID from Firebase Authentication."
        },
        "nombre": {
          "type": "string",
          "description": "First name of the lawyer."
        },
        "apellido": {
          "type": "string",
          "description": "Last name of the lawyer."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Email address, used for login."
        },
        "provincia": {
          "type": "string",
          "description": "The province where the lawyer primarily practices."
        },
        "ciudad": {
          "type": "string",
          "description": "The city where the lawyer primarily practices."
        },
        "matricula": {
          "type": "string",
          "description": "Professional license number of the lawyer."
        },
        "fechaMatriculacion": {
          "type": "string",
          "format": "date-time",
          "description": "Date of professional licensing."
        },
        "credencialUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL to the uploaded image of the lawyer's professional ID."
        },
        "role": {
          "type": "string",
          "description": "User role, either 'user' or 'admin'.",
          "enum": [
            "user",
            "admin"
          ]
        },
        "status": {
          "type": "string",
          "description": "Registration status, 'pending' approval by an admin.",
          "enum": [
            "pending",
            "approved",
            "rejected"
          ]
        },
        "registrationDate": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the user registered."
        }
      },
      "required": [
        "uid",
        "nombre",
        "apellido",
        "email",
        "provincia",
        "ciudad",
        "matricula",
        "fechaMatriculacion",
        "credencialUrl",
        "role",
        "status",
        "registrationDate"
      ]
    },
    "Courthouse": {
      "title": "Courthouse",
      "type": "object",
      "description": "Represents a courthouse in Argentina.",
      "properties": {
        "nombre": {
          "type": "string",
          "description": "Name of the courthouse."
        },
        "dependencia": {
          "type": "string",
          "description": "Province or jurisdiction where the courthouse is located."
        },
        "ciudad": {
          "type": "string",
          "description": "City where the courthouse is located."
        },
        "fuero": {
          "type": "string",
          "description": "Legal area of the courthouse (e.g., Civil, Penal, Laboral)."
        },
        "instancia": {
          "type": "string",
          "description": "Level of the courthouse (e.g., First Instance, CÃ¡mara)."
        },
        "direccion": {
          "type": "string",
          "description": "Address of the courthouse."
        },
        "telefono": {
          "type": "string",
          "description": "Phone number of the courthouse."
        },
        "localidadId": {
          "type": "number",
          "description": "The ID of the city/locality."
        }
      },
      "required": [
        "nombre",
        "dependencia",
        "ciudad",
        "fuero",
        "instancia"
      ]
    },
    "Rating": {
      "title": "Rating",
      "type": "object",
      "description": "Represents a rating given to a courthouse by a lawyer.",
      "properties": {
        "courthouseId": {
          "type": "string",
          "description": "Reference to Courthouse. (Relationship: Courthouse 1:N Rating)"
        },
        "lawyerId": {
          "type": "string",
          "description": "Reference to Lawyer. (Relationship: Lawyer 1:N Rating)"
        },
        "puntuaciones": {
          "type": "object",
          "properties": {
            "calidadResoluciones": { "type": "number" },
            "rapidezResoluciones": { "type": "number" },
            "rapidezDespacho": { "type": "number" },
            "atencionMesaEntradas": { "type": "number" },
            "tratoProfesional": { "type": "number" },
            "puntualidadAudiencias": { "type": "number" },
            "ordenGeneral": { "type": "number" },
            "tecnologia": { "type": "number" },
            "practicidad": { "type": "number" },
            "capacitacionPersonal": { "type": "number" }
          },
          "required": [
            "calidadResoluciones",
            "rapidezResoluciones",
            "rapidezDespacho",
            "atencionMesaEntradas",
            "tratoProfesional",
            "puntualidadAudiencias",
            "ordenGeneral",
            "tecnologia",
            "practicidad",
            "capacitacionPersonal"
          ]
        },
        "comentario": {
          "type": "string",
          "description": "Anonymous comment about the courthouse."
        },
        "fechaExperiencia": {
          "type": "string",
          "description": "Date of the lawyer's experience at the courthouse.",
          "format": "date-time"
        },
        "fechaCalificacion": {
          "type": "string",
          "description": "Date and time when the rating was submitted.",
          "format": "date-time"
        },
        "status": {
            "type": "string",
            "description": "Moderation status of the rating.",
            "enum": ["pending", "approved", "rejected"]
        }
      },
      "required": [
        "courthouseId",
        "lawyerId",
        "puntuaciones",
        "fechaExperiencia",
        "fechaCalificacion",
        "status"
      ]
    },
    "Statistic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Statistic",
      "type": "object",
      "description": "Represents statistics for a courthouse.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the statistic."
        },
        "courthouseId": {
          "type": "string",
          "description": "Reference to Courthouse. (Relationship: Courthouse 1:1 Statistic)"
        },
        "generalAverage": {
          "type": "number",
          "description": "General average rating for the courthouse."
        },
        "totalRatings": {
          "type": "number",
          "description": "Total number of ratings for the courthouse."
        },
        "averageByCategory": {
          "type": "string",
          "description": "Average ratings by category (e.g., efficiency, resolution time). Represented as a JSON string.",
          "format": "json"
        },
        "lastUpdated": {
          "type": "string",
          "description": "Date and time when the statistics were last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "courthouseId",
        "generalAverage",
        "totalRatings",
        "averageByCategory",
        "lastUpdated"
      ]
    },
    "ArbitrarySentence": {
      "title": "Arbitrary Sentence",
      "description": "Represents a judicial sentence that has been declared arbitrary by a higher court.",
      "type": "object",
      "properties": {
        "lawyerId": {
          "type": "string",
          "description": "The UID of the lawyer who submitted the case."
        },
        "courthouseId": {
          "type": "string",
          "description": "The ID of the courthouse that issued the original challenged sentence."
        },
        "caseDetails": {
          "type": "object",
          "properties": {
            "caseNumber": { "type": "string" },
            "caseYear": { "type": "number" },
            "caseName": { "type": "string" }
          },
          "required": ["caseNumber", "caseYear", "caseName"],
          "description": "Basic details to identify the court case."
        },
        "challengedSentenceUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL to the PDF of the original sentence that was challenged."
        },
        "rulingSentenceUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL to the PDF of the higher court's ruling declaring the original sentence arbitrary."
        },
        "submissionDate": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of when the case was submitted to the platform."
        },
        "status": {
          "type": "string",
          "description": "Moderation status of the submission.",
          "enum": ["pending", "approved", "rejected"]
        }
      },
      "required": [
        "lawyerId",
        "courthouseId",
        "caseDetails",
        "challengedSentenceUrl",
        "rulingSentenceUrl",
        "submissionDate",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/lawyers/{uid}",
        "definition": {
          "entityName": "Lawyer",
          "schema": {
            "$ref": "#/backend/entities/Lawyer"
          },
          "description": "Stores lawyer profiles, using path-based ownership for security. Only the authenticated lawyer can read/write their own document.",
          "params": [
            {
              "name": "uid",
              "description": "The unique identifier for the lawyer, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/courthouses/{courthouseId}",
        "definition": {
          "entityName": "Courthouse",
          "schema": {
            "$ref": "#/backend/entities/Courthouse"
          },
          "description": "Stores courthouse information. Publicly readable, but only admins can create/update/delete.",
          "params": [
            {
              "name": "courthouseId",
              "description": "The unique identifier for the courthouse."
            }
          ]
        }
      },
      {
        "path": "/courthouses/{courthouseId}/ratings/{ratingId}",
        "definition": {
          "entityName": "Rating",
          "schema": {
            "$ref": "#/backend/entities/Rating"
          },
          "description": "Stores ratings for each courthouse. Includes denormalized 'lawyerId' for authorization independence. Lawyers can only manage their own ratings. Includes the courthouseId to allow retrieving ratings for one courthouse.",
          "params": [
            {
              "name": "courthouseId",
              "description": "The unique identifier for the courthouse."
            },
            {
              "name": "ratingId",
              "description": "The unique identifier for the rating."
            }
          ]
        }
      },
      {
        "path": "/courthouses/{courthouseId}/statistics/{statisticId}",
        "definition": {
          "entityName": "Statistic",
          "schema": {
            "$ref": "#/backend/entities/Statistic"
          },
          "description": "Stores statistics for each courthouse. Only updated by trusted server-side code.",
          "params": [
            {
              "name": "courthouseId",
              "description": "The unique identifier for the courthouse."
            },
            {
              "name": "statisticId",
              "description": "The unique identifier for the statistic. Should only ever be one document."
            }
          ]
        }
      },
      {
        "path": "/courthouses/{courthouseId}/arbitrary_sentences/{sentenceId}",
        "definition": {
          "entityName": "ArbitrarySentence",
          "schema": {
            "$ref": "#/backend/entities/ArbitrarySentence"
          },
          "description": "Stores submissions of sentences declared arbitrary for a specific courthouse. Lawyers can create, but only admins can approve/reject.",
          "params": [
            {
              "name": "courthouseId",
              "description": "The unique identifier for the courthouse that issued the original sentence."
            },
            {
              "name": "sentenceId",
              "description": "The unique identifier for the arbitrary sentence submission."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the core features of the \"Justicia Calificada\" application, emphasizing secure authentication, courthouse ratings, and statistical analysis. The structure prioritizes authorization independence, clear security rules, and efficient data retrieval. Path-based ownership is used for lawyers, and a combination of path-based ownership and denormalization is employed to manage access to ratings and statistics.\n\n**Authorization Independence:** Lawyer profiles are stored directly under `/lawyers/{uid}` which allows easy management of lawyer-specific data and authentication. The `Rating` documents under `/courthouses/{courthouseId}/ratings/{ratingId}` include the `lawyerId`, enabling security rules to verify that the authenticated user (`request.auth.uid`) matches the rating's `lawyerId`. This avoids the need for `get()` calls to the `/lawyers/{uid}` collection to check ownership.\n\n**QAPs Support:** The structure supports Query Approval Patterns (QAPs) by segregating data based on access requirements. Lawyers' data are stored in `/lawyers/{uid}`, which allows listing lawyers with appropriate filtering rules. Courthouse data in `/courthouses/{courthouseId}` allows public listing while statistics are managed separately in `/courthouses/{courthouseId}/statistics/{statisticId}`, enabling different security rules for each. Ratings are located in a subcollection, ensuring we can query ratings for a specific courthouse, and because each rating contains the lawyerId, we can filter/secure lists of ratings based on the authenticated lawyer.\n\n**Denormalization:** The `Rating` documents include the `lawyerId`. This is a form of denormalization to enable security rules to ensure that only the lawyer who created the rating can modify or delete it. This eliminates the need for server-side validation to verify the user's identity against the rating data.\n\n**Global Roles (DBAC):** Global admin roles are defined by a `role` field within the `/lawyers/{uid}` document. This simplifies the data model and removes the need for a separate collection for roles.\n"
  }
}
